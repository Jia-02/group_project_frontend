<div class="container">
  <div class="header">
    <img src="logo5.png" alt="Logo">
    <div class="nameBox">
      <div class="nameDiv">
        <span class="nameLable">外送員</span>
        <span>{{name}}</span>
      </div>
      <div class="nameDiv">
        <span class="nameLable">電　話</span>
        <span>{{phone}}</span>
      </div>
    </div>
    <div class="logout-btn" (click)="Signout()">
      <mat-icon fontIcon="logout"></mat-icon>
    </div>
  </div>

  <div class="main">
    <div class="sidebar">
      <nav>
        <ul>
          <li><a routerLink="/front" routerLinkActive="active">首頁</a></li>
          <li><a routerLink="/todays/orders" routerLinkActive="active">今日已完成</a></li>
          <li><a routerLink="/analyze" routerLinkActive="active">薪資分析</a></li>
          <li><a routerLink="/historyorders" routerLinkActive="active">歷史訂單</a></li>
        </ul>
      </nav>
    </div>

    <div class="content">
      <div class="bottom-section">
        <h2 class="section-title">歷史訂單查詢</h2>

        <div class="filter-section">
          <div>
            <mat-form-field appearance="outline">
              <mat-label>選擇單一日期</mat-label>
              <input matInput [matDatepicker]="picker" [(ngModel)]="selectedDate" (dateChange)="filterBySingleDate($event)">
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>
          </div>

          <div class="divider"><span>或 區間搜尋</span></div>

          <div class="date-row">
            <mat-form-field appearance="outline">
              <mat-label>開始日期</mat-label>
              <input matInput [matDatepicker]="startPicker" [(ngModel)]="startDate">
              <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
              <mat-datepicker #startPicker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>結束日期</mat-label>
              <input matInput [matDatepicker]="endPicker" [(ngModel)]="endDate">
              <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
              <mat-datepicker #endPicker></mat-datepicker>
            </mat-form-field>
          </div>

          <div class="btn-row">
            <button mat-raised-button color="primary" class="search-btn" (click)="filterByRange()">
              <mat-icon>search</mat-icon> 搜尋區間
            </button>
            <button mat-stroked-button color="warn" class="reset-btn" (click)="resetFilter()">
              重置
            </button>
          </div>
        </div>

        <div class="summary-box">
           接單數: <strong>{{ items.length }}</strong> 單 / 總金額: <strong>{{totalMoney}}</strong> 元
        </div>

        @if (items.length > 0) {
          <mat-accordion>
            @for (item of items; track item.orderNo) {
              <mat-expansion-panel hideToggle (opened)="loadOrderDetail(item)">
                <mat-expansion-panel-header>
                  <mat-panel-title>{{ item.orderNo }}</mat-panel-title>
                  <mat-panel-description>
                    <span class="info-row">{{ item.distanceKm }}km / ${{ item.money }}</span>
                    <span class="info-row date">{{ item.date }}</span>
                  </mat-panel-description>
                </mat-expansion-panel-header>

                @for (p of item.products; track p.name) {
                  <div class="product-item">
                    <div class="product-info">
                      <span class="p-name">{{ p.name }}</span>
                      <span class="p-options">({{ p.options.join(', ') }})</span>
                    </div>
                  </div>
                }
                <p class="total-price-row">總價: <span>${{ item.totalPrice }}</span></p>
              </mat-expansion-panel>
            }
          </mat-accordion>
        } @else {
          <div class="no-data">
            <mat-icon>inbox</mat-icon>
            <p>沒有符合條件的資料</p>
          </div>
        }
      </div>
    </div>
  </div>
</div>
