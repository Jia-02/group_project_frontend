<h2 mat-dialog-title>
  {{ data.settingName }}
  <button (click)="dialogRef.close()">
    <mat-icon>close</mat-icon>
  </button>
</h2>

<mat-dialog-content>
  <img [src]="data.settingImg" alt="{{ data.settingName }}">
  <span>NT$ {{ data.settingPrice }}</span>
  <h3>選擇餐點組合</h3>
  @if (data.settingDetail.length) {
    @for (categoryGroup of data.settingDetail; track categoryGroup.categoryId) {
      @for (productGroup of categoryGroup.detailList; track productGroup.productId){
        <h4><input type="radio"  [name]="'mainProduct_' + categoryGroup.categoryId"
        [checked]="selectedMainProduct.get(categoryGroup.categoryId) === productGroup.productId"
        (change)="handleMainProductChange(categoryGroup, productGroup)">
        {{ productGroup.productName }} (單點價格: {{ productGroup.productPrice }})  可能過敏原:{{ productGroup.productNote }}</h4>
      }
      @for (optionGroup of categoryGroup.optionList; track optionGroup.optionId) {
        {{ optionGroup.optionName }} 最多選擇 {{ optionGroup.maxSelect }} 項<br>
        @for (optionItem of optionGroup.optionDetail; track optionItem.option) {
          @if (currentSelections.get(optionGroup.optionId); as selectedSet) {
            @if (optionGroup.maxSelect > 1) {
              <input type="checkbox" [checked]="selectedSet.has(optionItem.option)"
              [disabled]="!selectedSet.has(optionItem.option) && selectedSet.size >= optionGroup.maxSelect"
              (change)="selectedSet.clear();selectedSet.add(optionItem.option);calculateTotalPrice();">
            } @else {
              <input type="radio" [name]="'optionGroup_' + optionGroup.optionId" [checked]="selectedSet.has(optionItem.option)"
              (change)="selectedSet.clear();selectedSet.add(optionItem.option);calculateTotalPrice();">
            }
            {{ optionItem.option }} (+NT$ {{ optionItem.addPrice }})<br>
          }
        }
      }
    }
  }
</mat-dialog-content>

<mat-dialog-actions>
  <button (click)="decrementQuantity()"><mat-icon>remove</mat-icon></button>
  <input type="number" [(ngModel)]="quantity" min="1" class="numberCss">
  <button (click)="incrementQuantity()"><mat-icon>add</mat-icon></button>
</mat-dialog-actions>

<mat-dialog-actions>
  <h3>總價格:{{ currentPrice }}</h3>
  <button [disabled]="!quantity || quantity <= 0|| !isSelectionComplete" (click)="addToCart()" class="buttonCss">
    加入購物車
  </button>
</mat-dialog-actions>
