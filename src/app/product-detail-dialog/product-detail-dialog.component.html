<h2 mat-dialog-title class="dialogHeader">
  <span class="headerTitle">{{ data.productName }}</span>
  <button class="closeBtn" (click)="dialogRef.close()">
    <mat-icon>close</mat-icon>
  </button>
</h2>

<mat-dialog-content class="dialogContent">
  <img [src]="data.imageUrl" alt="{{ data.productName }}" class="heroImage">
  <div class="productInfoSection">
    <div class="productHeader">
      <h3 class="productTitle">{{ data.productName }}</h3>
      <span class="basePrice">NT$ {{ data.productPrice }}</span>
    </div>
    <p class="productDesc">{{ data.productDescription }}</p>
  </div>

  <div class="customizationSection">
    <h3 class="sectionTitle">客製化選項</h3>

    @if (data.optionList.length) {
      @for (optionGroup of data.optionList; track optionGroup.optionId) {

        <div class="optionGroup">
          <div class="groupHeader">
            <span class="groupName">{{ optionGroup.optionName }}</span>
            <span class="groupLimit">(最多選 {{ optionGroup.maxSelect }} 項)</span>
          </div>

          <div class="optionList">
            @for (optionItem of optionGroup.optionDetail; track optionItem.option) {
              @if (currentSelections.get(optionGroup.optionId); as selectedSet) {

                <label class="optionRow">

                  <div class="inputWrapper">
                    @if (optionGroup.maxSelect > 1) {
                      <input type="checkbox"
                             class="nativeInput"
                             [checked]="selectedSet.has(optionItem.option)"
                             [disabled]="!selectedSet.has(optionItem.option) && selectedSet.size >= optionGroup.maxSelect"
                             (change)="selectedSet.has(optionItem.option) ? selectedSet.delete(optionItem.option) : selectedSet.add(optionItem.option);calculateTotalPrice();">
                    } @else {
                      <input type="radio"
                             [name]="'optionGroup_' + optionGroup.optionId"
                             class="nativeInput"
                             [checked]="selectedSet.has(optionItem.option)"
                             (change)="selectedSet.clear(); selectedSet.add(optionItem.option); calculateTotalPrice();">
                    }
                  </div>

                  <span class="optName">{{ optionItem.option }}</span>
                  <span class="optPrice">+NT$ {{ optionItem.addPrice }}</span>
                </label>
              }
            }
          </div>
        </div>
      }
    }
  </div>
</mat-dialog-content>

<div class="footerContainer">
  <mat-dialog-actions class="quantityPanel">
    <button class="qtyBtn" (click)="decrementQuantity()">
      <mat-icon>remove</mat-icon>
    </button>
    <input type="number" [(ngModel)]="quantity" min="1" class="qtyInput" readonly>
    <button class="qtyBtn" (click)="incrementQuantity()">
      <mat-icon>add</mat-icon>
    </button>
  </mat-dialog-actions>

  <mat-dialog-actions class="cartPanel">
    <button [disabled]="!quantity || quantity <= 0" (click)="addToCart()" class="addToCartBtn">
      <span class="cartText">加入購物車</span>
      <span class="totalPrice">NT$ {{ currentPrice }}</span>
    </button>
  </mat-dialog-actions>
</div>
