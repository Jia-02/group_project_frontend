<div class="background">
  <div class="main-layout-container">

    <div class="calendarPanel">

      <!-- 行事曆 -->
      <div class="header">
        <h2 class="monthTitle">
          {{ currentMonth() | date: 'yyyy年 MM月' }}
        </h2>
        <div class="navButtons">
          <button (click)="prevMonth()" class="navButton" aria-label="上個月">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
          </button>
          <button (click)="nextMonth()" class="navButton" aria-label="下個月">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </button>
        </div>
      </div>

      <div class="calendarGrid">
        <div class="dayNames">
          @for (dayName of dayNames; track $index) {
          <div class="dayName">
            {{ dayName }}
          </div>
          }
        </div>

        <div class="calendarCss">
          @for (week of monthWeeks; track $index) {
          <div class="calendarWeek">
            @for (day of week; track $index) {
            <div class="calendarDays" (click)="selectDay(day)">

              <div class="dayContent" [class.is-selected]="isSameDate(day, selectedDay())"
                [class.is-today]="isToday(day)" [class.is-other-month]="!isSameMonth(day, currentMonth())">

                <span class="dayNumber">{{ day | date: 'd' }}</span>

                @if (hasActivity(day)) {
                <div class="activityDot" [class.dot-white]="isSameDate(day, selectedDay())"
                  [class.dot-blue]="!isSameDate(day, selectedDay())">
                </div>
                }
              </div>
            </div>
            }
          </div>
          }
        </div>

      </div>
    </div>


    <!-- 右側當日狀態 -->
    <div class="schedulePanel">
      <div class="scheduleHeader">
        <h3 class="scheduleTitle">
          {{ selectedDay() | date: 'yyyy年 MM月 dd日' }} ({{ getDayName(selectedDay()) }})
        </h3>
      </div>


      <!-- 桌位狀態 -->
      <div class="table-header-row"
        [style.grid-template-columns]="'var(--time-label-width) repeat(' + tables().length + ', minmax(100px, 1fr))'">
        <div class="time-label-spacer"></div>
        @for (table of tables(); track table.table_id) {
        <div class="tableHeader">
          <span class="tableName" [class.text-muted]="table.table_status !== '開放'">
            {{ table.table_id }}
            <span style="font-size: 12px">({{ table.capacity }}人)</span>
          </span>

          <!-- 開關按鈕 -->
          <label class="toggleSwitch" title="切換開放狀態">
            <input type="checkbox" [checked]="table.table_status == '開放'" (change)="tableAvailabe(table)">
            <span class="slider round"></span>
          </label>
        </div>
        }
      </div>


      <div class="time-grid-container"
        [style.grid-template-columns]="'var(--time-label-width) repeat(' + tables().length + ', minmax(100px, 1fr))'">
        <!-- 時間 -->
        @for (label of timeLabels; track label.time) {
        <div class="timeLabelCell">
          {{ label.display }}
        </div>

        @for (table of tables(); track table.table_id) {
        <div class="hourSlot" [class.isUnavailable]="table.table_status !== '開放'"
          (click)="addReservation(table.table_id, label.hour)"
          title="{{ table.table_status == '開放' ? '點擊新增預約' : '未開放' }}">
        </div>
        }
        }

        <div class="activitiesLayer"
          [style.grid-template-columns]="'repeat(' + tables().length + ', minmax(100px, 1fr))'">

          @for (reserveData of currentDayReserve(); track reserveData.id) {
          <div class="activityBlock" [style.top.px]="getTopPosition(reserveData.reservationTime)"
            [style.height.px]="getHeight(reserveData.useTime)" [style.grid-column]="getTableGridColumn(reserveData)"
            title="{{ reserveData.reservationName }}">

            <div class="activityContent">
              <span class="customer-name">{{ reserveData.reservationName }}</span>
              <span class="table-time">{{ reserveData.reservationTime }} - {{ reserveData.endTime }}</span>
            </div>
          </div>
          }
        </div>
      </div>

    </div>

  </div>
