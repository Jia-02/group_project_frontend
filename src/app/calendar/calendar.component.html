<div class="header">
  <button (click)="prevMonth()">⬅</button>
  <h3>{{ currentMonth | date: 'yyyy年 MMM' }}</h3>
  <button (click)="nextMonth()">⮕</button>

</div>
<div class="display">
  <div class="calendar-wrapper">
    <table class="calendar-table">
      <thead>
        <tr>
          @for (dayName of dayNames; track $index) {
          <th>{{ dayName }}</th>
          }
        </tr>
      </thead>

      <tbody>
        @for (week of monthWeeks; track $index) {
        <tr class="calendar-week">
          @for (day of week; track $index) {
          <td class="calendar-day" [class.is-current-month]="day && (day | date: 'MM') === (currentMonth | date: 'MM')"
            (click)="selectDay(day)">

            @if (day) {
            <span class="day-number">{{ day | date: "d" }}</span>

            <div class="activity-bar-container">
              @for (act of getDayActivities(day); track act.id) {
              <div class="activity-bar" [class.multi-day]="isMultiDay(act)">
                @if (isActivityStartDay(act, day) || !isMultiDay(act)) {
                <span class="activity-title">{{ act.title }}</span>
                }
              </div>
              }
            </div>
            }
          </td>

          }
        </tr>
        }
      </tbody>
    </table>
  </div>

  <div>
    <div class="sidebar-card">
      <h3>新增活動</h3>
      <div class="sidebar-line"></div>
      <textarea></textarea>
      <button (click)="addActivity()">+</button>
    </div>

    <div class="sidebar-card">
      <h3>{{ selectedDay | date: 'MM/dd' }} 的活動</h3>
      <div class="sidebar-line"></div>

      <div class="activities-content">
        @if (selectedDayActivities.length) {
        <ul>
          @for (activity of selectedDayActivities; track $index) {
          <li>
            <span>{{ activity.title }}</span><br>
            <span>{{ activity.description }}</span>
          </li>
          }
        </ul>
        } @else {
        <p class="no-activity">本日沒有活動。</p>
        }
      </div>
    </div>
  </div>
</div>
