<div class="calendar-container">

  <div class="header">
    <button (click)="prevMonth()">â¬…</button>
    <h3>{{ currentMonth | date: 'yyyyå¹´ MMM' }}</h3>
    <button (click)="nextMonth()">â®•</button>
  </div>

  <div class="display">

    <!-- ======= æœˆæ›†å€ ======= -->
    <div class="calendar-wrapper">
      <table class="calendar-table">
        <thead>
          <tr>
            @for (dayName of dayNames; track $index) {
            <th>{{ dayName }}</th>
            }
          </tr>
        </thead>

        <tbody>
          @for (week of monthWeeks; track $index) {
          <tr class="calendar-week">

            @for (day of week; track $index) {
            <td class="calendar-day"
              [class.is-current-month]="day && (day | date:'MM') === (currentMonth | date:'MM')"
              [class.selected-day]="selectedDay && day && (day | date:'yyyy-MM-dd') === (selectedDay | date:'yyyy-MM-dd')"
              (click)="selectDay(day)">

              @if (day) {

              <!-- æ—¥æœŸæ•¸å­— -->
              <span class="day-number">{{ day | date:'d' }}</span>

              <!-- æ´»å‹•æ¢ -->
              <div class="activity-bar-container">
                @for (act of getDayActivities(day); track act.id) {

                <!-- ðŸš¨ ä¿®æ­£ï¼šé‡æ–°åŠ å…¥ [ngClass] ç‹€æ…‹ç¶å®šä»¥é¡¯ç¤ºé¡è‰² -->
                <div
                  class="activity-bar"
                  [class.multi-day]="isMultiDay(act)"
                  [title]="act.title + ' (' + act.status + ')'"
                  [ngClass]="{
                    'activity-published': act.status === 'published',
                    'activity-draft': act.status === 'draft'
                  }"
                >

                  @if (isActivityStartDay(act, day) || !isMultiDay(act)) {
                  <span class="activity-title">{{ act.title }}</span>
                  }
                </div>

                }
              </div>

              }
            </td>
            }

          </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- ======= å´é‚Šæ¬„ ======= -->
    <div>

      <!-- æ–°å¢žæ´»å‹• -->
      <div class="sidebar-card">
        <h3>æ–°å¢žæ´»å‹•</h3>
        <div class="sidebar-line"></div>
        <label>æ´»å‹•æ¨™é¡Œ:<input type="text" [(ngModel)]="title"></label><br>
        <label>æ´»å‹•å…§å®¹:<input type="text" [(ngModel)]="description"></label><br>
        <label>æ´»å‹•æ™‚é–“:
          <input type="date" [(ngModel)]="startDate" required /> ~
          <input type="date" [(ngModel)]="endDate" required />
        </label>
        <button (click)="openDialog()">æ–°å¢žæ´»å‹•</button>
      </div>


      <!-- ä»Šæ—¥æ´»å‹• -->
      <div class="sidebar-card">
        <h3>{{ selectedDay | date:'MM/dd' }} çš„æ´»å‹•</h3>
        <div class="sidebar-line"></div>

        <div class="activities-content">

          @if (selectedDayActivities.length > 0) {

          <ul>
            @for (activity of selectedDayActivities; track activity.id) {

            <!-- ðŸš¨ ä¿®æ­£ï¼šå°‡ç‹€æ…‹æ¨£å¼ç¶å®šåˆ°è©³æƒ…åˆ—è¡¨é …ç›®ä¸Š -->
            <li [ngClass]="{
              'detail-published': activity.status === 'published',
              'detail-draft': activity.status === 'draft'
            }">
              <strong>{{ activity.title }}</strong><br>
              <span>{{ activity.description }}</span><br>
              <small>
                {{ activity.startDate | date:'MM/dd' }}
                -
                {{ activity.endDate | date:'MM/dd' }}
              </small>
            </li>
            }
          </ul>

          } @else {
          <p class="no-activity">æœ¬æ—¥æ²’æœ‰æ´»å‹•ã€‚</p>
          }

        </div>
      </div>

    </div>
  </div>
</div>

